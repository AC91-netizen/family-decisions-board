<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Family Decisions Board - Parent</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {margin:0;font-family:Arial,sans-serif;background:#0f172a;color:#fff;text-align:center;}
h1 {padding:16px;}
.board {display:flex; flex-wrap:wrap; justify-content:center;}
.card {background:#1e293b;border-radius:14px;padding:16px;margin:12px;width:320px;}
.stat {font-size:18px;margin:6px 0;}
button {width:100%;padding:10px;margin:6px 0;border:none;border-radius:8px;font-size:16px;cursor:pointer;}
.goodBtn {background:#22c55e;}
.badBtn {background:#ef4444;}
.spendBtn {background:#16a34a;}
.choreBtn {background:#f59e0b;}
.serveBtn {background:#3b82f6;}
.resetBtn {background:#64748b;}
#pinContainer {margin:20px;}
#loginBtn {background:#fbbf24;padding:10px 16px;border-radius:8px;font-size:16px;border:none;cursor:pointer;}
.tip {font-size:14px;color:#facc15;margin-top:4px;}
</style>
</head>

<body>

<h1>Parent Dashboard</h1>

<div id="pinContainer">
  <label>Enter Parent PIN: <input type="password" id="parentPin"></label>
  <button id="loginBtn">Enter</button>
  <p id="pinMsg"></p>
</div>

<div class="board" id="board" style="display:none;"></div>

<script>
window.onload = function () {
  const CORRECT_PIN = "1234"; // Change your PIN
  const pinInput = document.getElementById("parentPin");
  const pinMsg = document.getElementById("pinMsg");
  const board = document.getElementById("board");

  document.getElementById("loginBtn").onclick = () => {
    if(pinInput.value===CORRECT_PIN){
      document.getElementById("pinContainer").style.display="none";
      board.style.display="flex";
      initBoard();
    } else {
      pinMsg.innerText="Incorrect PIN!";
    }
  };

  function initBoard(){
    const children = ["Nevaeh", "Arley"];

    firebase.initializeApp({
      apiKey: "AIzaSyDdz0V7qMrYPN5_NmCYUMHSSf9JL5HAkAM",
      authDomain: "family-decisions-board-57d6a.firebaseapp.com",
      projectId: "family-decisions-board-57d6a"
    });
    const db = firebase.firestore();

    children.forEach(name => {
      const card = document.createElement("div");
      card.className="card";
      card.id=name;
      card.innerHTML=`
        <h2>${name}</h2>
        <div class="stat goodStat">üü¢ Good: 0</div>
        <div class="stat badStat">üî¥ Bad (Active): 0</div>
        <div class="stat lockStat">üìµ Tech Lock Remaining: 0</div>
        <div class="tip" id="${name}_tip"></div>
        <button class="goodBtn">+ Good Decision</button>
        <button class="badBtn">+ Bad Decision</button>
        <button class="spendBtn">‚≠ê Spend Good Token</button>
        <button class="choreBtn">üßπ Complete Chore</button>
        <button class="serveBtn">Serve 1 Tech Day</button>
        <button class="resetBtn">Reset</button>
      `;
      board.appendChild(card);

      const ref = db.collection("familyBoard").doc(name);

      // Initialize if missing
      ref.get().then(doc=>{ if(!doc.exists) ref.set({good:0,badActive:0,badTotal:0,techLockEarned:0,techLockRemaining:0}); });

      const goodBtn = card.querySelector(".goodBtn");
      const badBtn = card.querySelector(".badBtn");
      const spendBtn = card.querySelector(".spendBtn");
      const choreBtn = card.querySelector(".choreBtn");
      const serveBtn = card.querySelector(".serveBtn");
      const resetBtn = card.querySelector(".resetBtn");

      goodBtn.onclick = () => ref.get().then(doc=>{
        const val = (doc.data().good||0)+1; ref.update({good:val});
      });
      badBtn.onclick = () => ref.get().then(doc=>{
        let data = doc.data();
        let totalBad = (data.badTotal||0)+1;
        let activeBad = (data.badActive||0)+1;
        let good = Math.max(0,(data.good||0)-1);
        let techEarned = data.techLockEarned||0;
        let techRemaining = data.techLockRemaining||0;
        if(totalBad%3===0){
          const after3pm = new Date().getHours()>=15;
          const days = after3pm?2:1;
          techEarned+=days;
          techRemaining+=days;
        }
        ref.update({badTotal:totalBad,badActive:activeBad,good,techLockEarned:techEarned,techLockRemaining:techRemaining});
      });
      spendBtn.onclick = () => ref.get().then(doc=>{
        const val = doc.data().good||0;
        if(val>0) ref.update({good:val-1});
      });
      choreBtn.onclick = () => ref.get().then(doc=>{
        const val = doc.data().badActive||0;
        if(val>0) ref.update({badActive:val-1});
      });
      serveBtn.onclick = () => ref.get().then(doc=>{
        const val = doc.data().techLockRemaining||0;
        if(val>0) ref.update({techLockRemaining:val-1});
      });
      resetBtn.onclick = () => { if(confirm(`Reset ${name}'s stats?`)) ref.set({good:0,badActive:0,badTotal:0,techLockEarned:0,techLockRemaining:0}); };

      ref.onSnapshot(doc=>{
        if(!doc.exists) return;
        const d = doc.data();
        card.querySelector(".goodStat").innerText="üü¢ Good: "+d.good;
        card.querySelector(".badStat").innerText="üî¥ Bad (Active): "+d.badActive;
        card.querySelector(".lockStat").innerText=d.techLockRemaining>0 ? "üìµ Tech Lock Remaining: "+d.techLockRemaining : "üéâ Tech Available! Keep up the good choices!";
        const tip = card.querySelector(".tip");
        if(d.techLockRemaining>0){
          tip.innerText="‚ö†Ô∏è Tech is locked. Focus on good behaviour!";
        } else if(d.badActive>0){
          tip.innerText="Be careful! Try to avoid bad decisions.";
        } else if(d.good>0){
          tip.innerText="Great job! Keep up the good choices!";
        } else {
          tip.innerText="Make positive choices to earn rewards!";
        }
      });
    });
  }
};
</script>

</body>
</html>
