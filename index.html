<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Family Decisions Board - Child View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {margin:0;font-family:Arial,sans-serif;background:#0f172a;color:#fff;text-align:center;}
h1 {padding:16px;}
.board {display:flex; flex-wrap:wrap; justify-content:center;}
.card {background:#1e293b;border-radius:14px;padding:16px;margin:12px;width:320px;}
.stat {font-size:18px;margin:6px 0;}
.tip {font-size:14px;color:#facc15;margin-top:4px;}
button {padding:10px 16px;margin:6px;border:none;border-radius:8px;font-size:16px;cursor:pointer;}
#adminBtn {background:#fbbf24;color:#000;}
#rulesBtn {background:#3b82f6;color:#fff;}
.modalOverlay {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;}
.modal {background:#1e293b;padding:20px;border-radius:12px;width:90%;max-width:400px;text-align:left;}
.closeBtn {margin-top:12px;background:#ef4444;color:#fff;width:auto;padding:6px 12px;border-radius:6px;}
</style>
</head>

<body>

<h1>Family Decisions Board</h1>

<div>
  <button id="adminBtn">Go to Parent Page</button>
  <button id="rulesBtn">Token Rules</button>
</div>

<div class="board" id="board"></div>

<!-- Rules Modal -->
<div class="modalOverlay" id="rulesModal">
  <div class="modal">
    <h2>Token Rules</h2>
    <ul>
      <li>ðŸŸ¢ Good tokens: Earned for positive behaviour. Can be saved/spent for rewards.</li>
      <li>ðŸ”´ Bad tokens: Earned for poor choices. Every 3 lifetime bads = 1 tech lock day (2 if after 3pm).</li>
      <li>Bad tokens cannot cancel tech locks already earned.</li>
      <li>Chores can remove active bad tokens but not tech locks already assigned.</li>
      <li>Tech available = ðŸŽ‰ Keep making good choices!</li>
    </ul>
    <button class="closeBtn" onclick="document.getElementById('rulesModal').style.display='none'">Close</button>
  </div>
</div>

<script>
window.onload = function () {
  const children = ["Nevaeh", "Arley"];
  const board = document.getElementById("board");

  firebase.initializeApp({
    apiKey: "AIzaSyDdz0V7qMrYPN5_NmCYUMHSSf9JL5HAkAM",
    authDomain: "family-decisions-board-57d6a.firebaseapp.com",
    projectId: "family-decisions-board-57d6a"
  });

  const db = firebase.firestore();

  // Buttons
  document.getElementById("adminBtn").onclick = ()=> {
    window.location.href = "admin.html";
  };
  document.getElementById("rulesBtn").onclick = ()=> {
    document.getElementById("rulesModal").style.display = "flex";
  };

  children.forEach(name => {
    const card = document.createElement("div");
    card.className = "card";
    card.id = name;
    card.innerHTML = `
      <h2>${name}</h2>
      <div class="stat goodStat">ðŸŸ¢ Good: 0</div>
      <div class="stat badStat">ðŸ”´ Bad (Active): 0</div>
      <div class="stat lockStat">ðŸ“µ Tech Lock Remaining: 0</div>
      <div class="tip" id="${name}_tip"></div>
    `;
    board.appendChild(card);

    const ref = db.collection("familyBoard").doc(name);

    // Initialize if missing
    ref.get().then(doc => { 
      if(!doc.exists) ref.set({good:0,badActive:0,badTotal:0,techLockEarned:0,techLockRemaining:0}); 
    });

    // Live updates
    ref.onSnapshot(doc=>{
      if(!doc.exists) return;
      const d = doc.data();
      card.querySelector(".goodStat").innerText = "ðŸŸ¢ Good: "+d.good;
      card.querySelector(".badStat").innerText = "ðŸ”´ Bad (Active): "+d.badActive;
      card.querySelector(".lockStat").innerText = d.techLockRemaining>0 ? "ðŸ“µ Tech Lock Remaining: "+d.techLockRemaining : "ðŸŽ‰ Tech Available!";

      // Constructive tips based on individual values
      const tip = card.querySelector(".tip");
      if(d.techLockRemaining>0){
        tip.innerText = "ðŸ“µ Tech is locked. Focus on positive choices and earning good tokens to reduce red tokens.";
      } else if(d.badActive>=3){
        tip.innerText = `You have ${d.badActive} red tokens. Doing chores can reduce them. Keep earning blue tokens by making good choices!`;
      } else if(d.badActive>0){
        tip.innerText = `You have ${d.badActive} red token(s). Chores help remove them. Keep making good choices!`;
      } else if(d.good>=5){
        tip.innerText = `Awesome! You have ${d.good} blue tokens. Keep up the great choices!`;
      } else if(d.good>0){
        tip.innerText = `Good work! You have ${d.good} blue token(s). Keep earning more!`;
      } else {
        tip.innerText = "Make positive choices to earn blue tokens!";
      }
    });
  });
};
</script>

</body>
</html>
