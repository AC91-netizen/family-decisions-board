<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Family Decisions Board</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#0f172a;
  color:#fff;
  text-align:center;
}
h1 {
  padding:16px;
}
.board {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
}
.card {
  background:#1e293b;
  border-radius:14px;
  padding:16px;
  margin:12px;
  width:320px;
}
.stat {
  font-size:18px;
  margin:6px 0;
}
button {
  width:100%;
  padding:10px;
  margin:6px 0;
  border:none;
  border-radius:8px;
  font-size:16px;
}
.goodBtn { background:#22c55e; }
.badBtn { background:#ef4444; }
.spendBtn { background:#16a34a; }
.choreBtn { background:#f59e0b; }
.serveBtn { background:#3b82f6; }
.resetBtn { background:#64748b; }
</style>
</head>

<body>

<h1>Family Decisions Board</h1>
<div class="board" id="board"></div>

<script>
window.onload = function () {

  /* üîê CHANGE THIS */
  const PARENT_PIN = "1234";

  /* üë®‚Äçüë©‚Äçüëß Children */
  const children = ["Nevaeh", "Arley"];

  const board = document.getElementById("board");

  /* üî• Firebase Init */
  firebase.initializeApp({
    apiKey: "AIzaSyDdz0V7qMrYPN5_NmCYUMHSSf9JL5HAkAM",
    authDomain: "family-decisions-board-57d6a.firebaseapp.com",
    projectId: "family-decisions-board-57d6a"
  });

  const db = firebase.firestore();

  function askPin() {
    return prompt("Parent PIN:");
  }

  /* Build UI first */
  children.forEach(name => {
    const card = document.createElement("div");
    card.className = "card";
    card.id = name;
    card.innerHTML = `
      <h2>${name}</h2>

      <div class="stat goodStat">üü¢ Good: 0</div>
      <div class="stat badStat">üî¥ Bad (Active): 0</div>
      <div class="stat lockStat">üìµ Tech Lock Days: 0</div>

      <button class="goodBtn">+ Good Decision</button>
      <button class="badBtn">+ Bad Decision</button>
      <button class="spendBtn">‚≠ê Spend Good Token</button>
      <button class="choreBtn">üßπ Complete Chore</button>
      <button class="serveBtn">Serve 1 Tech Day</button>
      <button class="resetBtn">Reset (Parent)</button>
    `;
    board.appendChild(card);
  });

  /* Firestore logic */
  children.forEach(name => {
    const ref = db.collection("familyBoard").doc(name);

    // Create doc if missing
    ref.get().then(doc => {
      if (!doc.exists) {
        ref.set({
          good: 0,
          badActive: 0,
          badTotal: 0,
          techLock: 0
        });
      }
    });

    ref.onSnapshot(doc => {
      if (!doc.exists) return;
      const d = doc.data();
      const el = document.getElementById(name);

      el.querySelector(".goodStat").innerText = "üü¢ Good: " + d.good;
      el.querySelector(".badStat").innerText = "üî¥ Bad (Active): " + d.badActive;
      el.querySelector(".lockStat").innerText = "üìµ Tech Lock Days: " + d.techLock;

      // Good decision
      el.querySelector(".goodBtn").onclick = () => {
        ref.update({ good: d.good + 1 });
      };

      // Bad decision
      el.querySelector(".badBtn").onclick = () => {
        if (askPin() !== PARENT_PIN) return alert("Wrong PIN");

        let badTotal = d.badTotal + 1;
        let badActive = d.badActive + 1;
        let good = Math.max(0, d.good - 1);
        let techLock = d.techLock;

        if (badTotal % 3 === 0) {
          const after3pm = new Date().getHours() >= 15;
          techLock += after3pm ? 2 : 1;
        }

        ref.update({ badTotal, badActive, good, techLock });
      };

      // Spend good token
      el.querySelector(".spendBtn").onclick = () => {
        if (askPin() !== PARENT_PIN) return alert("Wrong PIN");
        if (d.good > 0) ref.update({ good: d.good - 1 });
      };

      // Complete chore
      el.querySelector(".choreBtn").onclick = () => {
        if (askPin() !== PARENT_PIN) return alert("Wrong PIN");
        if (d.badActive > 0) ref.update({ badActive: d.badActive - 1 });
      };

      // Serve tech lock
      el.querySelector(".serveBtn").onclick = () => {
        if (askPin() !== PARENT_PIN) return alert("Wrong PIN");
        if (d.techLock > 0) ref.update({ techLock: d.techLock - 1 });
      };

      // Reset child
      el.querySelector(".resetBtn").onclick = () => {
        if (askPin() !== PARENT_PIN) return alert("Wrong PIN");
        ref.set({
          good: 0,
          badActive: 0,
          badTotal: 0,
          techLock: 0
        });
      };
    });
  });
};
</script>

</body>
</html>
